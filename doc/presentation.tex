\documentclass[10pt,a4paper]{beamer}
\usepackage[utf8]{inputenc}
\usepackage[french]{babel}
\usepackage[T1]{fontenc}
\usepackage{tikz}
%% \usepackage{graphicx}
%% \usepackage{lmodern}
%% \usepackage{kpfonts}
\author{Benjamin Bonneau \& Maxime Flin }
\title{Projet de système d'exploitation \\ --- Rock and Roll ---}
\begin{document}
\maketitle

\begin{frame}
  Sommaire:
  \begin{enumerate}
  \item Introduction
  \item Boot
  \item Mémoire
  \item Appels systèmes
  \item Processus
  \item Système de fichier
  \item Libc
  \item Conclusion et améliorations
  \end{enumerate}
\end{frame}

\begin{frame}
  \frametitle{Introduction}
  \textrm{ecos} est un système d'exploitation. Il propose une interface très proche des normes \textrm{POSIX}. Il propose:
  \begin{itemize}
  \item une gestion de processus concurrent
  \item un système de fichier
  \item une implémentation de la librarie standard C
  \item des programmes utilitaires courants (\textrm{cat}, \textrm{ls}, etc\ldots)
  \item un shell
  \end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Boot}
	\textrm{src/boot}

	\begin{itemize}
		\item GRUB
			\begin{itemize}
				\item kernel (ELF)
				\item carte de la mémoire
				\item affichage
			\end{itemize}
		\item \textit{protected mode 32 bits} vers \textit{long mode 64 bits}
		\item Control Registers
		\item Paging
		\item Global Descriptor Table
		\item Chargement du kernel
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Mémoire}
	Paging 4 niveaux: 48 bits d'adresse

	\vspace{1.0cm}

	\begin{tikzpicture}
	\tikzset{
      table/.style={rectangle},
      link/.style={->}
	}
	\node[style=draw] (cr3) at (0, 2) {\textbf{CR3}};
	\node[table] (pml4) at (0,0) {
		\begin{tabular}{|c|}
			\hline
			\textbf{PML4} \\
			47..39    \\
			\hline
				0x1ff \\
			\hline
				...   \\
			\hline
				0x000 \\
			\hline
		\end{tabular}
	};
	\node at (0, -1.8) {\textit{loop}};
	\node[table] (pdpt) at (2,0) {
		\begin{tabular}{|c|}
			\hline
			\textbf{PDPT} \\
			38..30    \\
			\hline
				0x1ff \\
			\hline
				...   \\
			\hline
				0x000 \\
			\hline
		\end{tabular}
	};
	\node[table] (pd) at (4,0) {
		\begin{tabular}{|c|}
			\hline
			\textbf{PD} \\
			29..21    \\
			\hline
				0x1ff \\
			\hline
				...   \\
			\hline
				0x000 \\
			\hline
		\end{tabular}
	};
	\node[table] (pt) at (6,0) {
		\begin{tabular}{|c|}
			\hline
			\textbf{PT} \\
			20..12    \\
			\hline
				0x1ff \\
			\hline
				...   \\
			\hline
				0x000 \\
			\hline
		\end{tabular}
	};
	\node[table] (page) at (9, 0) {
		\begin{tabular}{|c|}
			\hline
			\textbf{Page physique} \\
			11..12        \\
			offset		  \\
			\hline
		\end{tabular}
	};
	\draw[link] (cr3.south) -- (pml4.north);
	\draw[link] (pml4.east) -- (pdpt.west);
	\draw[link] (pdpt.east) -- (pd.west);
	\draw[link] (pd.east)   -- (pt.west);
	\draw[link] (pt.east)   -- (page.west);
	\draw[style=<-] (pml4.260) arc (180:360:0.3cm);

	\end{tikzpicture}
\end{frame}

\begin{frame}
	\frametitle{Mémoire}
	Allocation des pages physiques disponibles

	\begin{itemize}
		\item découpage de la mémoire en blocs de 2Mo
		\item au niveau d'un bloc: arbre d'arité 8 (3 niveaux)
		\item pour gérer l'ensemble des blocs:
			2 arbres d'arité 64. Blocs entièrement libres et blocs partiellement libres.
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Mémoire}

	\begin{itemize}
		\item chaque processus dispose de son PML4
		\item partie basse: userspace
		\item partie haute: kernel
		\item entrées spéciales dans la partie userspace:
			\begin{itemize}
				\item Pages partagées (libc)
				\item Pages allouées lors de l'accès (.bss, pile)
				\item Pages copiées lors de l'accès (fork)
			\end{itemize}
			actions effectuées lors de l'accès détecté par un page fault
	\end{itemize}

\end{frame}

\begin{frame}
	\frametitle{Execve}
	\begin{itemize}
		\item effectué par un processus auxiliaire avec privilèges de niveau 1
		\item gestion des fichiers spécifiant un interpréteur (\texttt{\#!})
		\item chargement de fichiers ELF
		\item création d'un nouveau paging
		\item allocation et chargement de sections depuis le fichier: .text, .data, .rodata
		\item marquage des pages à allouer lors de l'accès: .bss (initialisé à 0), pile
		\item ajout de la libc
		\item copie des arguments et paramêtres d'environnement
	\end{itemize}
\end{frame}

\end{document}
